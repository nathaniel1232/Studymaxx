â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ AUTOMATISK PREMIUM AKTIVERING - KOMPLETT GUIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## STEG 1: KONFIGURER STRIPE WEBHOOK

1. GÃ¥ til: https://dashboard.stripe.com/webhooks

2. Klikk "Add endpoint" (eller "Legg til endepunkt")

3. Fyll inn:
   - Endpoint URL: https://studymaxx.vercel.app/api/stripe/webhook
   - Description: Premium Activation
   
4. Velg events to send - VIKTIGT! Velg disse 3:
   âœ… checkout.session.completed
   âœ… customer.subscription.updated  
   âœ… customer.subscription.deleted

5. Klikk "Add endpoint"

6. PÃ¥ neste side - KOPIER "Signing secret"
   - Starter med "whsec_..."
   - Du trenger denne i neste steg!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## STEG 2: LEGG TIL WEBHOOK SECRET I VERCEL

1. GÃ¥ til: https://vercel.com/dashboard

2. Velg prosjektet ditt (studymaxx)

3. GÃ¥ til "Settings" â†’ "Environment Variables"

4. Legg til NY variabel:
   - Name: STRIPE_WEBHOOK_SECRET
   - Value: whsec_... (fra Stripe steg 6)
   - Environments: âœ… Production âœ… Preview âœ… Development
   - Klikk "Save"

5. **VIKTIG**: Redeploy appen
   - GÃ¥ til "Deployments"
   - Finn siste deployment
   - Klikk "..." menyen â†’ "Redeploy"
   - Vent til deployment er ferdig (grÃ¸nn checkmark)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## STEG 3: TEST AT DET FUNKER

### Metode 1: Test webhook i Stripe (anbefalt)

1. GÃ¥ til: https://dashboard.stripe.com/webhooks
2. Klikk pÃ¥ webhook du opprettet
3. Klikk "Send test webhook"
4. Velg "checkout.session.completed"
5. Klikk "Send test webhook"

### Sjekk Vercel logs:
1. GÃ¥ til Vercel dashboard
2. Klikk "Logs" (eller "Functions")
3. SÃ¸k etter "/api/stripe/webhook"
4. Du skal se:
   âœ… "[Webhook] âœ… Event signature verified"
   âœ… "[Webhook] Checkout completed"
   âœ… "[Webhook] âœ…âœ…âœ… SUCCESS! User upgraded to Premium"

### Metode 2: KjÃ¸p en test subscription

1. Bruk Stripe test mode
2. Test card: 4242 4242 4242 4242
3. KjÃ¸p premium
4. Sjekk Vercel logs (samme som over)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## VANLIGE PROBLEMER

### Problem: "No stripe-signature header"
**LÃ¸sning:** Webhook URL er feil i Stripe. Sjekk at det er:
https://studymaxx.vercel.app/api/stripe/webhook

### Problem: "Webhook signature verification failed"
**LÃ¸sning:** 
- Webhook secret er feil i Vercel
- Kopier NÃ˜YAKTIG fra Stripe (inkluder whsec_)
- Redeploy Vercel etter endring

### Problem: "Cannot identify user - no userId"
**Dette er IKKE problemet** - koden sender userId korrekt

### Problem: Ingen logs i Vercel
**LÃ¸sning:** Webhook er ikke konfigurert eller sender ikke events
- Sjekk at webhook er "Enabled" i Stripe
- Sjekk at URL er riktig
- Test med "Send test webhook"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## BEKREFT AT DET FUNKER

Etter du har gjort alt over:

1. GÃ¥ til Stripe webhook dashboard
2. Klikk pÃ¥ webhook
3. Se "Recent events" - skal se events med âœ… grÃ¸nn checkmark
4. Hvis rÃ¸d X â†’ klikk pÃ¥ event â†’ se error message
5. Fix error og test pÃ¥ nytt

## EMERGENCY BACKUP

Hvis webhook fortsatt ikke funker etter 24 timer:
- Bruk fix-single-user.js for nye brukere midlertidig
- Send meg error logs fra Vercel
- Sjekk Stripe webhook logs for error messages

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## NÃ…R DET FUNKER

Du vil se i Vercel logs ved hver kjÃ¸p:
```
[Webhook] âœ… Event signature verified: checkout.session.completed
[Webhook] CHECKOUT SESSION COMPLETED
[Webhook] âœ… User identified: xxx-xxx-xxx
[Webhook] âœ…âœ…âœ… SUCCESS! User xxx upgraded to Premium
[Webhook] CHECKOUT COMPLETED SUCCESSFULLY
```

Og brukeren fÃ¥r premium UMIDDELBART uten Ã¥ logge ut/inn!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
